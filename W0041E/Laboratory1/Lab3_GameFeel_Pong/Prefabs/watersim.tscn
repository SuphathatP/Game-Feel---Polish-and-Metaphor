[gd_scene load_steps=17 format=3 uid="uid://cdbpaiqms1wpo"]

[ext_resource type="Script" uid="uid://hy5q0dv7wlel" path="res://W0041E/Laboratory1/Lab3_GameFeel_Pong/Scripts/Water.cs" id="1_l66fi"]
[ext_resource type="Shader" uid="uid://ble0dh7pvottq" path="res://shared/shaders/simulation.gdshader" id="1_wj5qs"]
[ext_resource type="Shader" uid="uid://c7d7kiigmb7le" path="res://shared/shaders/water.tres" id="2_7fen6"]
[ext_resource type="Shader" uid="uid://v3wvmylpqv6y" path="res://shared/shaders/buffer.tres" id="2_dfset"]
[ext_resource type="Material" uid="uid://b13ap22ai1ii5" path="res://shared/materials/Mat_Base_Water.tres" id="4_l66fi"]

[sub_resource type="ViewportTexture" id="ViewportTexture_fn5i0"]
viewport_path = NodePath("Simulation")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_6vesp"]
resource_local_to_scene = true
shader = ExtResource("2_dfset")
shader_parameter/Texture2DParameter = SubResource("ViewportTexture_fn5i0")

[sub_resource type="ViewportTexture" id="ViewportTexture_2psol"]
viewport_path = NodePath("Collision")

[sub_resource type="ViewportTexture" id="ViewportTexture_iyhgh"]
viewport_path = NodePath("SimulationBuffer")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_cg4ft"]
resource_local_to_scene = true
shader = ExtResource("1_wj5qs")
shader_parameter/sim_tex = SubResource("ViewportTexture_iyhgh")
shader_parameter/col_tex = SubResource("ViewportTexture_2psol")
shader_parameter/phase = 0.18
shader_parameter/attenuation = 0.995
shader_parameter/deltaUV = 2.3

[sub_resource type="Environment" id="Environment_38vk1"]
background_mode = 1

[sub_resource type="PlaneMesh" id="PlaneMesh_psqb2"]
material = ExtResource("4_l66fi")
size = Vector2(50, 50)
subdivide_width = 500
subdivide_depth = 500

[sub_resource type="ViewportTexture" id="ViewportTexture_m1c3a"]
viewport_path = NodePath("Simulation")

[sub_resource type="ViewportTexture" id="ViewportTexture_ceg2r"]
viewport_path = NodePath("Simulation")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_f7voy"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("2_7fen6")
shader_parameter/simulation2 = SubResource("ViewportTexture_ceg2r")
shader_parameter/amplitude = 0.5
shader_parameter/refraction_strength = 0.1
shader_parameter/simulation = SubResource("ViewportTexture_m1c3a")
shader_parameter/deep_water = Color(0, 0.168627, 0.643137, 0.945098)
shader_parameter/shallow_water = Color(0, 0.34902, 0.34902, 0.67451)
shader_parameter/murkiness = 0.407

[sub_resource type="PlaneMesh" id="PlaneMesh_ntba4"]
material = SubResource("ShaderMaterial_f7voy")
size = Vector2(10.1, 10.1)
subdivide_width = 500
subdivide_depth = 500

[node name="Water" type="Node3D"]
script = ExtResource("1_l66fi")

[node name="SimulationBuffer" type="SubViewport" parent="."]
size = Vector2i(514, 512)
render_target_clear_mode = 2
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="SimulationBuffer"]
material = SubResource("ShaderMaterial_6vesp")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 1)

[node name="Simulation" type="SubViewport" parent="."]
size = Vector2i(514, 512)
render_target_clear_mode = 2
render_target_update_mode = 4

[node name="ColorRect" type="ColorRect" parent="Simulation"]
material = SubResource("ShaderMaterial_cg4ft")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 1)

[node name="Collision" type="SubViewport" parent="."]
size = Vector2i(514, 512)
render_target_update_mode = 4

[node name="WaterCam" type="Camera3D" parent="Collision"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, -5, 0)
keep_aspect = 0
cull_mask = 524288
environment = SubResource("Environment_38vk1")
projection = 1
current = true
size = 10.1
near = 0.001
far = 5.0

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1.6945, 0)
visible = false
size = Vector3(12, 5, 12)
material = ExtResource("4_l66fi")

[node name="CSGBox3D2" type="CSGBox3D" parent="CSGBox3D"]
operation = 2
size = Vector3(10, 8, 10)

[node name="PoolFloor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -3.76016, 0)
mesh = SubResource("PlaneMesh_psqb2")

[node name="Water" type="MeshInstance3D" parent="."]
mesh = SubResource("PlaneMesh_ntba4")
